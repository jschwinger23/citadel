## 健康检查

每一个 ERU 节点上都运行了 eru-agent, 它会进行频密的健康检查(健康检查的行为细节需要参考 eru-agent 相应的设置项), 如果发现容器不健康, 会立刻报警并且从 ELB 上下线, 使其停止对外服务. 如果容器恢复健康, 则立刻重新上线 ELB.

#### 免费赠送的 TCP 健康检查

任何应用只要声明了 ports, 就意味着这个应用是需要挂载到 ELB 上接受流量的, 所以在部署的时候, Citadel 会免费赠送 TCP 健康检查, 也就是说容器启动以后, 只要 eru-agent 进行 TCP 拨号成功, 就认为该容器健康, 如果任何一个 port 未通过 TCP 健康检查, 则 Citadel 会将整个容器从 ELB 上下线.

#### HTTP 健康检查

可以声明 `healthcheck_url`, `healthcheck_http_port`, `healthcheck_expected_code` 来进行 HTTP 健康检查.

我们还遇到过一种情况, 有些应用虽然提供了健康检查接口, 在这个接口通过了 eru-agent 的健康检查以后, 还有一段"预热"时间, 这段时间内业务接口可能无法响应请求, 或者需要加载一些资源, 导致响应时间特别长, 这种情况实际上代表健康检查接口不能充分地体现应用的健康状态, 我们建议在健康检查接口上增加相应的逻辑, 使其能在应用初始化完成以后, 才返回 HTTP 200. 当然如果应用允许, 也可以直接用一个业务接口作为健康检查接口.
